<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phòng Chờ - SKY DODGE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
    :root { 
        --bg: #0f0c29; 
        --glass: rgba(255, 255, 255, 0.1);
        --neon: #00d2ff;
        --primary: #9d50bb;
    }
    
    body { 
        background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
        color: white; 
        font-family: 'Orbitron', sans-serif; 
        margin: 0; padding: 20px; 
        display: flex; gap: 20px; height: 100vh; overflow: hidden;
    }

    /* BÊN TRÁI: BÀN CHƠI */
    .game-area { flex: 2; display: flex; flex-direction: column; }
    
    .bet-header {
        background: var(--glass);
        padding: 15px; border-radius: 15px;
        border-left: 5px solid var(--neon);
        margin-bottom: 30px;
    }

    .slots-grid { 
        display: grid; grid-template-columns: repeat(3, 1fr); 
        gap: 25px; align-content: center; flex-grow: 1;
    }

    .slot { 
        background: rgba(0, 0, 0, 0.3); 
        border: 2px solid rgba(0, 210, 255, 0.3);
        border-radius: 20px; aspect-ratio: 1/1; 
        display: flex; align-items: center; justify-content: center;
        transition: 0.3s; position: relative;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    .slot:hover { border-color: var(--neon); box-shadow: 0 0 20px var(--neon); }
    
    .slot.occupied { border: 2px solid var(--primary); border-style: solid; }
    .slot img { width: 90%; height: 90%; border-radius: 15px; object-fit: cover; }
    
    .fa-plus { font-size: 30px; color: rgba(255,255,255,0.2); }

    /* BÊN PHẢI: DANH SÁCH BẠN BÈ */
    .friends-sidebar { 
        flex: 0.8; background: rgba(255, 255, 255, 0.05); 
        backdrop-filter: blur(10px); border-radius: 20px;
        border: 1px solid rgba(255,255,255,0.1);
        display: flex; flex-direction: column;
    }

    .sidebar-header { 
        padding: 20px; text-align: center; font-size: 20px;
        letter-spacing: 2px; border-bottom: 1px solid rgba(255,255,255,0.1);
        color: var(--neon); text-shadow: 0 0 10px var(--neon);
    }

    .friends-list { flex-grow: 1; overflow-y: auto; padding: 15px; }
    
    .friend-item { 
        display: flex; align-items: center; justify-content: space-between;
        background: rgba(255,255,255,0.05); padding: 10px;
        border-radius: 12px; margin-bottom: 10px;
    }

    .friend-info { display: flex; align-items: center; gap: 10px; }
    .friend-avatar { width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--neon); }

    .btn-invite { 
        background: transparent; border: 1px solid var(--neon);
        color: var(--neon); padding: 5px 15px; border-radius: 8px;
        font-size: 11px; cursor: pointer; transition: 0.3s;
    }
    .btn-invite:hover { background: var(--neon); color: black; }

    /* NÚT ĐIỀU KHIỂN */
    .actions { display: flex; justify-content: space-between; margin-top: 20px; }
    .btn-main { 
        padding: 12px 35px; border-radius: 12px; border: none;
        font-weight: bold; cursor: pointer; text-transform: uppercase;
    }
    .btn-exit { background: #ff4b2b; color: white; }
    .btn-start { 
        background: linear-gradient(45deg, #9d50bb, #6e48aa); 
        color: white; box-shadow: 0 0 15px var(--primary);
    }
</style>

<div class="game-area">
    <div class="bet-header">
        <span style="color: #aaa;">MỨC CƯỢC:</span> 
        <input type="number" value="1000" style="background:none; border:none; color:var(--neon); font-size:20px; font-weight:bold; width:150px; outline:none;">
    </div>
    
    <div class="slots-grid">
        <div class="slot"><i class="fas fa-plus"></i></div>
        <div class="slot"><i class="fas fa-plus"></i></div>
        <div class="slot"><i class="fas fa-plus"></i></div>
        <div class="slot"><i class="fas fa-plus"></i></div>
        <div class="slot"><i class="fas fa-plus"></i></div>
        <div class="slot"><i class="fas fa-plus"></i></div>
    </div>

    <div class="actions">
        <button class="btn-main btn-exit">Thoát</button>
        <button class="btn-main btn-start">Bắt Đầu Trận Đấu</button>
    </div>
</div>

<div class="friends-sidebar">
    <div class="sidebar-header">DANH SÁCH BẠN</div>
    <div class="friends-list" id="friend-list-content">
        </div>
</div>

<script>
    // Duy dán cấu hình Firebase của Duy vào đây
    const firebaseConfig = { /* ... */ };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database(), auth = firebase.auth();

    let roomId = "room_default"; // Duy có thể tạo ID ngẫu nhiên nếu muốn nhiều phòng
    let myId, myName;

    auth.onAuthStateChanged(user => {
        if (user) {
            myId = user.uid;
            db.ref('users/' + myId + '/name').once('value', s => {
                myName = s.val();
                joinRoom();
            });
        } else { location.href = 'auth.html'; }
    });

    function joinRoom() {
        // Thêm mình vào danh sách người chơi trong phòng
        const roomRef = db.ref('rooms/' + roomId + '/players/' + myId);
        roomRef.set({ name: myName, status: "waiting" });
        roomRef.onDisconnect().remove();

        // Lắng nghe danh sách người chơi
        db.ref('rooms/' + roomId + '/players').on('value', snap => {
            const listDiv = document.getElementById('player-list');
            listDiv.innerHTML = "";
            snap.forEach(child => {
                listDiv.innerHTML += `<div class="player-item">${child.val().name}</div>`;
            });
        });

        // Lắng nghe lệnh bắt đầu từ chủ phòng
        db.ref('rooms/' + roomId + '/state').on('value', snap => {
            if (snap.val() === "playing") {
                window.location.href = "game.html?mode=multi&room=" + roomId;
            }
        });
    }

    async function startGame() {
        const bet = document.getElementById('bet-amount').value;
        if (!bet || bet <= 0) return alert("Vui lòng nhập tiền cược!");

        // Thiết lập tổng tiền thưởng và trạng thái bắt đầu
        await db.ref('rooms/' + roomId).update({
            state: "playing",
            totalPrize: bet, // Tổng tiền sẽ được tính dựa trên số người x tiền cược
            betPerPerson: bet
        });
    }
</script>
</body>
</html>
